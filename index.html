<!DOCTYPE html>
<html>
  <head>
    <title>EEDF</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="shortcut icon" href="img/favicon.ico">
    <link rel="stylesheet" href="css/leaflet/leaflet.css">
    <link rel="stylesheet" href="css/leaflet/leaflet.awesome-markers.css">
    <link rel="stylesheet" href="css/leaflet/leaflet.easy-button.css">
    <link rel="stylesheet" href="css/leaflet/leaflet.spin.css">
    <link rel="stylesheet" href="css/fontawesome.css">
    <link rel="stylesheet" href="css/eedf.css">
    <script src="js/jquery/jquery-3.3.1.min.js"></script>
    <script src="js/jquery/jquery.csv.min.js"></script>
    <script src="js/leaflet/leaflet.js"></script>
    <script src="js/leaflet/leaflet.awesome-markers.min.js"></script>
    <script src="js/leaflet/leaflet.easy-button.js"></script>
    <script src="js/leaflet/leaflet.shp.js"></script>
    <script src="js/leaflet/leaflet.shpfile.js"></script>
    <script src="js/leaflet/leaflet.spin.min.js"></script>
    <script src="js/rainbowvis/rainbowvis.js"></script>
    <script src="js/spin/spin.js"></script>
    <!-- polyfill for IE -->
    <script src="js/polyfills/array.find.js"></script>
    <!-- polyfill for Edge -->
    <script src="js/polyfills/encoding.js"></script>
  </head>
  <body>
    <div id="map"></div>
    <script src="js/config.js"></script>
    <script src="js/data.js"></script>
    <script src="js/maps/eedf.js"></script>
    <script src="js/maps/centres.js"></script>
    <script src="js/maps/camps.js"></script>
    <script src="js/maps/bafa.js"></script>
    <script src="js/maps/holiday.js"></script>
    <script src="js/maps/camps-children-centre.js"></script>
    <script src="js/maps/camps-children-department.js"></script>
    <script src="js/maps/camps-trainings-holidays.js"></script>
    <script type="text/javascript">
      var tileLayer,
        map,
        features = {},
        infos = {},
        viewId = "CentresMap";

      function initTileLayer() {
        // Mapbox custom tile layer
        tileLayer = L.tileLayer("{urlTemplate}/{z}/{x}/{y}?access_token={accessToken}", {
          urlTemplate: mapboxConfig.urlTemplate,
          accessToken: mapboxConfig.accessToken
        });
      }

      function setDefaultView() {
        // France GPS coordinates
        map.setView([47, 2], 6.4);
      }

      function createMap() {
        map = L.map("map", {
          minZoom: 6.4,
          zoomDelta: 0.2,
          zoomSnap: 0
        });

        setDefaultView();

        map.addLayer(tileLayer);
      }

      function addIcons() {
        // Centres bénévoles et CPN
        L.easyButton("fa-home", function() {
          selectMap("CentresMap");
        }, titles["CentresMap"]).addTo(map);
        // Camps par département
        L.easyButton("fa-campground", function() {       
          selectMap("CampsMap");
        }, titles["CampsMap"]).addTo(map);
        // Stages par centre
        L.easyButton("fa-chalkboard-teacher", function() {
          selectMap("BafaMap");
        }, titles["BafaMap"]).addTo(map);
        // Séjours par centre
        L.easyButton("fa-sun", function() {
          selectMap("HolidayMap");
        }, titles["HolidayMap"]).addTo(map);
        // Camps et enfants par centre
        L.easyButton("fa-child", function() {
          selectMap("CampsChildrenCentreMap");
        }, titles["CampsChildrenCentreMap"]).addTo(map);
        // Camps et enfants par département
        L.easyButton("fa-child", function() {
          selectMap("CampsChildrenDepartmentMap");
        }, titles["CampsChildrenDepartmentMap"]).addTo(map);
        // Camps, stages et séjour par centre
        L.easyButton("fa-star-of-life", function() {
          selectMap("CampsTrainingsHolidaysMap");
        }, titles["CampsTrainingsHolidaysMap"]).addTo(map);
      }

      function removeLayers() {
        map.eachLayer(function(layer) {
          // do not remove tile layer
          if (!(layer instanceof L.TileLayer)) {
            map.removeLayer(layer);
          }
        });
      }

      function removeInfoControl(info) {
        if (info) {
          info.remove();
        }
      }

      function resetMap() {
        // remove layers
        removeLayers();

        // remove info control
        removeInfoControl(infos[viewId]);

        // reset view
        setDefaultView();
      }

      function loadView(viewId) {
        this.viewId = viewId;

        new window[viewId]().load();
      }

      function updateMap() {
        features[viewId].addTo(map);
        infos[viewId].addTo(map);
      }

      function selectMap(viewId) {
        resetMap(viewId);

        loadView(viewId);

        updateMap();
      }

      $(function() {
        // init tile layer
        initTileLayer();

        // create map
        createMap();

        // add icons to choose the view
        addIcons();

        // default selection
        selectMap("CentresMap");
      });
    </script>
  </body>
</html>